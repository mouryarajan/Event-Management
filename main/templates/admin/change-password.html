{% load static %}
<!DOCTYPE html>
<html lang="en">
    <!-- Mirrored from themesbrand.com/foxia/blue/pages-login.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Mar 2020 06:57:08 GMT -->
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta
            name="viewport"
            content="width=device-width,initial-scale=1,user-scalable=0,minimal-ui"
        />
        <title>Change Password | eVentes</title>
        <meta content="Admin Dashboard" name="description" />
        <meta content="Themesbrand" name="author" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <!-- App Icons -->
        <link
            rel="shortcut icon"
            href="{% static 'admin_plugins/images/favicon.png' %}"
        />
        <!-- Sweet Alert -->
        <link
            href="{% static 'admin_plugins/plugins/sweet-alert2/sweetalert2.min.css' %}"
            rel="stylesheet"
            type="text/css"
        />
        <!-- App css -->
        <link
            href="{% static 'admin_plugins/css/bootstrap.min.css' %}"
            rel="stylesheet"
            type="text/css"
        />
        <link
            href="{% static 'admin_plugins/css/icons.css' %}"
            rel="stylesheet"
            type="text/css"
        />
        <link
            href="{% static 'admin_plugins/css/style.css' %}"
            rel="stylesheet"
            type="text/css"
        />
    </head>
    <body>
        <!-- Loader -->
        <div id="preloader">
            <div id="status">
                <div class="spinner"></div>
            </div>
        </div>
        <!-- Begin page -->
        <div class="accountbg"></div>
        <div class="wrapper-page">
            <div class="card">
                <div class="card-body">
                    <div class="text-center">
                        <a href="index.html" class="logo-admin"
                            ><img
                                src="{% static 'admin_plugins/images/loginlogo.png' %}"
                                height="26"
                                alt="logo"
                        /></a>
                    </div>
                    <div class="p-3">
                        <form
                            id="form"
                            class="form-horizontal"
                            action=""
                            method="POST"
                            enctype="multipart/form-data"
                        >
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="userpassword">Old Password</label>
                                <input
                                    required
                                    type="password"
                                    class="form-control"
                                    name="txtoldpassword"
                                    id="txtoldpassword"
                                    placeholder="Enter your old password"
                                />
                            </div>
                            <div class="form-group">
                                <label for="userpassword">New Password</label>
                                <input
                                    required
                                    type="password"
                                    class="form-control"
                                    name="txtnewpassword"
                                    id="txtnewpassword"
                                    placeholder="Enter your new password"
                                    data-parsley-minlength="8"
                                    data-parsley-uppercase="1"
                                    data-parsley-lowercase="1"
                                    data-parsley-number="1"
                                    data-parsley-special="1"
                                />
                            </div>
                            <div class="form-group">
                                <label for="userpassword"
                                    >Confirm Password</label
                                >
                                <input
                                    data-parsley-equalto="#txtnewpassword"
                                    data-parsley-equalto-message="Password Doesn't Match"
                                    required
                                    type="password"
                                    class="form-control"
                                    name="txtcnfpassword"
                                    id="txtcnfpassword"
                                    placeholder="Confirm your password"
                                />
                            </div>
                            <div class="form-group row m-t-30">
                                <div class="col-sm-6">
                                    <div class="col-12 text-center">
                                        <a
                                            name="reset"
                                            href="{% url 'reset_password' %}"
                                            class="text-muted"
                                            ><i class="mdi mdi-lock"></i> Forgot
                                            your password?</a
                                        >
                                    </div>
                                </div>
                                <div class="col-sm-6 text-right">
                                    <button
                                        id="submit-btn"
                                        class="btn btn-primary w-md waves-effect waves-light"
                                        type="submit"
                                    >
                                        Change Password
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- jQuery  -->
        <script src="{% static 'admin_plugins/js/jquery.min.js' %}"></script>
        <script src="{% static 'admin_plugins/js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'admin_plugins/js/modernizr.min.js' %}"></script>
        <script src="{% static 'admin_plugins/js/waves.js' %}"></script>
        <script src="{% static 'admin_plugins/js/jquery.slimscroll.js' %}"></script>
        <script src="{% static 'admin_plugins/plugins/parsleyjs/parsley.min.js' %}"></script>
        <script src="{% static 'admin_plugins/plugins/sweet-alert2/sweetalert2.min.js' %}"></script>
        <script src="{% static 'admin_plugins/plugins/alertify/js/alertify.js' %}"></script>
        <!-- App js -->
        <script src="{% static 'admin_plugins/js/app.js' %}"></script>
        <script>
            //has uppercase
            window.Parsley.addValidator("uppercase", {
                requirementType: "number",
                validateString: function (value, requirement) {
                    var uppercases = value.match(/[A-Z]/g) || [];
                    return uppercases.length >= requirement;
                },
                messages: {
                    en: " - Must contain at least (%s) uppercase letter.",
                },
            });
            //has lowercase
            window.Parsley.addValidator("lowercase", {
                requirementType: "number",
                validateString: function (value, requirement) {
                    var lowecases = value.match(/[a-z]/g) || [];
                    return lowecases.length >= requirement;
                },
                messages: {
                    en: " - Must contain at least (%s) lowercase letter.",
                },
            });
            //has number
            window.Parsley.addValidator("number", {
                requirementType: "number",
                validateString: function (value, requirement) {
                    var numbers = value.match(/[0-9]/g) || [];
                    return numbers.length >= requirement;
                },
                messages: {
                    en: " - Must contain at least (%s) number.",
                },
            });
            //has special char
            window.Parsley.addValidator("special", {
                requirementType: "number",
                validateString: function (value, requirement) {
                    var specials = value.match(/[^a-zA-Z0-9]/g) || [];
                    return specials.length >= requirement;
                },
                messages: {
                    en: " - Must contain at least (%s) special character.",
                },
            });
        </script>
        <script>
            $(document).ready(function () {
                $("#form").parsley();
                $("#submit-btn").click(function (e) {
                    if ($("#form").parsley().isValid()) {
                        e.preventDefault();
                        var oldpassword = $("#txtoldpassword").val();
                        var newpassword = $("#txtnewpassword").val();
                        var csrfmiddlewaretoken = $(
                            "[name='csrfmiddlewaretoken']"
                        )
                            .first()
                            .val();
                        var url = $("#form").data("url");
                        $.ajax({
                            url: url,
                            data: {
                                oldpassword: oldpassword,
                                newpassword: newpassword,
                                csrfmiddlewaretoken: csrfmiddlewaretoken,
                            },
                            type: "post",
                            success: function (response) {
                                swal({
                                    title: "Good job!",
                                    text: "You clicked the button!",
                                    type: "success",
                                    showCancelButton: 0,
                                    confirmButtonClass: "btn btn-success",
                                }).then(function () {
                                    location.replace("/admin");
                                });
                            },
                            error: function (response) {
                                alertify.error(
                                    response["responseJSON"]["error"]
                                );
                            },
                        });
                    }
                });
                $("a[name=reset]").click(function (e) {
                    e.preventDefault();
                    var url = $(this).attr("href");
                    localStorage.setItem("type", "admin");
                    location.replace(url);
                });
            });
        </script>
    </body>
    <!-- Mirrored from themesbrand.com/foxia/blue/pages-login.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Mar 2020 06:57:08 GMT -->
</html>
